---
import type { Tool } from '../../data/types';
import { getLicenseBadgeClass, getDifficultyBadgeClass, getDifficultyLabel } from '../../utils/tools';

interface Props {
  tool: Tool;
}

const { tool } = Astro.props;
const base = import.meta.env.BASE_URL;
const licenseBadge = getLicenseBadgeClass(tool.license);
const diffBadge = getDifficultyBadgeClass(tool.difficulty);
const diffLabel = getDifficultyLabel(tool.difficulty);

const platformIcons: Record<string, string> = {
  linux: 'ğŸ§',
  windows: 'ğŸªŸ',
  macos: 'ğŸ',
  android: 'ğŸ¤–',
  ios: 'ğŸ“±',
  web: 'ğŸŒ',
  docker: 'ğŸ³',
};
---

<a
  href={`${base}tool/${tool.slug}`}
  class="card block no-underline hover:no-underline group"
>
  <div class="flex items-start gap-3 mb-3">
    <!-- Logo / Emoji -->
    <div
      class="w-12 h-12 rounded-xl flex items-center justify-center text-2xl flex-shrink-0"
      style="background: var(--color-bg-tertiary)"
    >
      {tool.logoPlaceholderEmoji ?? 'ğŸ“¦'}
    </div>
    <div class="min-w-0 flex-1">
      <h3 class="font-semibold text-base truncate" style="color: var(--color-text-primary)">
        {tool.name}
      </h3>
      <p class="text-xs truncate" style="color: var(--color-text-secondary)">
        {tool.tagline}
      </p>
    </div>
  </div>

  <!-- Badges row -->
  <div class="flex flex-wrap gap-1.5 mb-3">
    <span class:list={['badge', licenseBadge]}>{tool.license}</span>
    <span class:list={['badge', diffBadge]}>{diffLabel}</span>
    {tool.selfHostable && (
      <span class="badge badge-selfhost">ğŸ  Selbst hostbar</span>
    )}
  </div>

  <!-- Replaces -->
  {tool.replacesTools.length > 0 && (
    <div class="flex flex-wrap gap-1 mb-3">
      {tool.replacesTools.map(r => (
        <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs bg-orange-500/10 text-orange-400">
          âš¡ {r}
        </span>
      ))}
    </div>
  )}

  <!-- Platforms -->
  <div class="flex items-center justify-between">
    <div class="flex gap-1">
      {tool.platforms.map(p => (
        <span class="text-sm" title={p}>{platformIcons[p] ?? p}</span>
      ))}
    </div>
    {tool.stars !== undefined && tool.stars > 0 && (
      <span class="flex items-center gap-1 text-xs" style="color: var(--color-text-muted)">
        <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>
        {tool.stars >= 1000 ? `${(tool.stars / 1000).toFixed(1)}k` : tool.stars}
      </span>
    )}
  </div>

  <!-- Hover CTA -->
  <div class="mt-3 pt-3 opacity-0 group-hover:opacity-100 transition-opacity text-center text-xs font-medium text-indigo-400" style="border-top: 1px solid var(--color-border)">
    Details ansehen â†’
  </div>
</a>
